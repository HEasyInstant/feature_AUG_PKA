

var staffId=window.localStorage.getItem("clientId"),staffName=window.localStorage.getItem("userName");function getAllOpenOrders(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),r="/admin/api/hotel/getOpenOrder?access_token="+e,a=0;return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:r,async:!1,data:'{"hotelCode":  '+t+',"staffId":'+staffId+"}",success:function(e){console.log("browser json"+e);try{if(1==e.success)if(null==e.orders){var t="<table id='p_orderTable' class='table table-bordered table-striped'><thead><tr><th width='5%'>#</th><th width='10%'>Room #</th><th width='15%'>Time</th><th width='60%'>Item Details</th><th width='10%'>Action</th></tr></thead><tbody>";t+="</tbody></table>",document.getElementById("p_orderTable").innerHTML=t,$.fn.DataTable.isDataTable("#p_orderTable")&&$("#p_orderTable").DataTable().destroy(),$("#p_orderTable").DataTable({paging:!0,lengthChange:!0,ordering:!0,info:!0,autoWidth:!0})}else{for(var r=e.orders,o=(t="<table id='p_orderTable' class='table table-bordered table-striped'><thead><tr><th width='5%'>#</th><th width='10%'>Room #</th><th width='15%'>Time</th><th width='55%'>Item Details</th><th width='15%'>Action</th></tr></thead><tbody>",0);o<r.length;o++)for(var d=r[o].guest.roomNumber,l=0;l<r[o].order.length;l++){var s=moment(new Date(r[o].order[l].orderDate+" UTC")).format("MMM DD, hh:mm:ss a").toString();t=t+"<tr'><td width='5%'>"+ ++a+"</td><td width='10%'>"+d+"</td><td width='15%'>"+s+"</td>";for(var n="<td width='55%'>",i=0;i<r[o].order[l].items.length;i++){var c=r[o].order[l].items[i].serviceName,h=r[o].order[l].items[i].serviceItemName,b=r[o].order[l].items[i].itemName,m=r[o].order[l].items[i].qty,g=r[o].order[l].items[i].amount,p="<table class='table table-bordered table-striped'>";n+=p=p+"<tr><td width='70%'>"+(null!=b&&""!=b?b:null!=h&&""!=h?h:c)+"</td><td width='10%'>"+m+"</td><td width='20%'>"+g+"</td></tr></table>"}t+=n=n+"</td><td width='15%'><button class='btn btn-info btn-sm' onclick=acceptOrder("+r[o].guest.guestCode+","+r[o].order[l].orderId+");>Accept</button></td></tr>"}t+="</tbody></table>",document.getElementById("pOrder").innerHTML=t,$.fn.DataTable.isDataTable("#p_orderTable")&&$("#p_orderTable").DataTable().destroy(),$("#p_orderTable").DataTable({paging:!0,scrollY:"500px",sScrollXInner:"100%",scrollCollapse:!0,lengthChange:!0,ordering:!0,info:!0,autoWidth:!0})}else console.log("inserted count is: "+e.insertedCount)}catch(e){}},error:function(e){}}),a}function getInprogressOrders(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),r="/admin/api/hotel/getInprogressOrder?access_token="+e,a=0;return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:r,async:!1,data:'{"hotelCode":  '+t+',"staffId":'+staffId+"}",success:function(e){console.log("browser json"+e);try{if(1==e.success)if(null==e.orders){a=0;var t="<table id='progress_orderTable' class='table table-bordered table-striped'><thead><tr><th width='5%'>#</th><th width='10%'>Room #</th><th width='15%'>Time</th><th width='60%'>Item Details</th><th width='10%'>Action</th></tr></thead><tbody>";t+="</tbody></table>",document.getElementById("progress_orderTable").innerHTML=t,$("#progress_orderTable").DataTable({paging:!0,lengthChange:!0,ordering:!0,info:!0,autoWidth:!0})}else{for(var r=e.orders,o=(t="<table id='progress_orderTable' class='table table-bordered table-striped' width='100%'><thead><tr width='100%'><th width='5%'>#</th><th width='10%'>Room #</th><th width='15%'>Time</th><th width='55%'>Item Details</th><th width='15%'>Action</th></tr></thead><tbody>",0);o<r.length;o++)for(var d=r[o].guest.roomNumber,l=0;l<r[o].order.length;l++){var s=moment(new Date(r[o].order[l].orderDate+" UTC")).format("MMM DD, hh:mm:ss a").toString();t=t+"<tr><td width='5%'>"+ ++a+"</td><td width='10%'>RM# "+d+"</td><td width='15%'>"+s+"</td>";for(var n="<td width='55%'>",i=0;i<r[o].order[l].items.length;i++){var c=r[o].order[l].items[i].serviceName,h=r[o].order[l].items[i].serviceItemName,b=r[o].order[l].items[i].itemName,m=r[o].order[l].items[i].qty,g=r[o].order[l].items[i].amount,p="<table class='table table-bordered table-striped'>";n+=p=p+"<tr><td width='70%'>"+(null!=b&&""!=b?b:null!=h&&""!=h?h:c)+"</td><td width='10%'>"+m+"</td><td width='20%'>"+g+"</td></tr></table>"}t+=n=n+"</td><td width='15%'><button class='btn btn-info btn-sm' onclick=completeOrders("+r[o].guest.guestCode+","+r[o].order[l].orderId+");>Complete</button></td></tr>"}t+="</tbody></table>",document.getElementById("progress_Order").innerHTML=t,$.fn.DataTable.isDataTable("#progress_orderTable")&&$("#progress_orderTable").DataTable().destroy(),$("#progress_orderTable").DataTable({paging:!0,scrollY:"500px",scrollCollapse:!0,lengthChange:!0,ordering:!0,info:!0,autoWidth:!0})}else console.log("inserted count is: "+e.insertedCount)}catch(e){}},error:function(){}}),a}var globalVarServiceName="";function getServiceName(e){var t=window.localStorage.getItem("token"),r=window.localStorage.getItem("hotelCodeVal"),a="/admin/api/hotel/getService?access_token="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:a,async:!1,data:'{"hotelCode": '+r+"}",success:function(t){console.log(t);try{if(1==t.success){var r=t.services;if(null==t.services||0==r.length);else for(var a=0;a<r.length;a++)r[a].serviceId==e&&(globalVarServiceName=r[a].serviceName)}else console.log("Can not get depts: "+t.err)}catch(e){console.log("error"+e)}},error:function(e,t){console.log(e.status),console.log(e.statusText),console.log(e.responseText)}})}function acceptOrder(e,t){var r="/api/guest/assignStaff?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:r,async:!1,data:'{"userCode": '+e+',"orderId": '+t+',"staffId": '+staffId+',"staffName": "'+staffName+'"}',success:function(e){console.log(e);try{1==e.success?($.fn.DataTable.isDataTable("#progress_orderTable")&&$("#progress_orderTable").DataTable().destroy(),$.fn.DataTable.isDataTable("#p_orderTable")&&$("#p_orderTable").DataTable().destroy(),getAllOpenOrders(),getInprogressOrders(),toastr.success("Order accepted")):toastr.error("failed to accept order")}catch(e){}},error:function(e,t){}})}function completeOrders(e,t){var r="/api/guest/completeOrder?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:r,data:'{"userCode": '+e+',"orderId": '+t+',"staffId": '+staffId+',"staffName": "'+staffName+'","remark": "Good Service"}',success:function(e){console.log("browser json"+e);try{1==e.success?($.fn.DataTable.isDataTable("#progress_orderTable")&&$("#progress_orderTable").DataTable().destroy(),$.fn.DataTable.isDataTable("#complete_orderTable")&&$("#complete_orderTable").DataTable().destroy(),getInprogressOrders(),getCloseOrders(),toastr.success("Order completed")):console.log("inserted count is: "+e.insertedCount)}catch(e){toastr.success("Failed to complete order")}},error:function(){}})}function getCloseOrders(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),r="admin/api/hotel/getClosedOrder?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:r,data:'{"hotelCode":  '+t+',"staffId":'+staffId+"}",success:function(e){console.log("browser json"+e);try{var t=0;if(1==e.success)if(null==e.orders){var r="<table id='complete_orderTable' class='table table-bordered table-striped' style='margin-left: 0px; width: 1059px;'><thead><tr><th width='5%'>#</th><th width='10%'>Room #</th><th width='15%'>Time</th><th width='55%'>Item Details</th></tr></thead><tbody>";r+="</tbody></table>",document.getElementById("complete_orderTable").innerHTML=r,$("#complete_orderTable").DataTable({paging:!0,lengthChange:!0,ordering:!0,info:!0,autoWidth:!0})}else{for(var a=e.orders,o=(r="<table id='complete_orderTable' class='table table-bordered table-striped'><thead><tr><th width='5%'>#</th><th width='10%'>Room #</th><th width='15%'>Time</th><th width='70%'>Item Details</th></tr></thead><tbody>",a.length-1);o>=0;o--)for(var d=a[o].guest.roomNumber,l=0;l<a[o].order.length;l++){var s=moment(new Date(a[o].order[l].orderDate+" UTC")).format("MMM DD, hh:mm:ss a").toString();r=r+"<tr style='margin-left: 0px; width: 1059px;'><td width='5%'>"+ ++t+"</td><td width='10%'>RM# "+d+"</td><td width='15%'>"+s+"</td>";for(var n="<td width='70%'>",i=0;i<a[o].order[l].items.length;i++){var c=a[o].order[l].items[i].serviceName,h=a[o].order[l].items[i].serviceItemName,b=a[o].order[l].items[i].itemName,m=a[o].order[l].items[i].qty,g=a[o].order[l].items[i].amount,p="<table class='table table-bordered table-striped'>";n+=p=p+"<tr><td width='70%'>"+(null!=b&&""!=b?b:null!=h&&""!=h?h:c)+"</td><td width='10%'>"+m+"</td><td width='20%'>"+g+"</td></tr></table>"}r+=n}r+="</tbody></table>",document.getElementById("complete_Order").innerHTML=r,$.fn.DataTable.isDataTable("#complete_orderTable")&&$("#complete_orderTable").DataTable().destroy(),$("#complete_orderTable").DataTable({paging:!0,scrollY:"500px",sScrollXInner:"100%",scrollCollapse:!0,lengthChange:!0,ordering:!0,info:!0,autoWidth:!0})}else console.log("inserted count is: "+e.insertedCount)}catch(e){}},error:function(){}})}
fromDashboard=!1,open_Order_s=0,total_Order_s=0,total_feedback_count_s=0,checkedin_customer_s=0;var timeout,checkAndNotifyTimout,staffId=window.localStorage.getItem("clientId"),staffName=window.localStorage.getItem("userName");function bulkCheckoutGuest(e){event.preventDefault();window.localStorage.getItem("hotelCodeVal");var t="api/guest/checkoutBulk?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t,data:'{"checkoutGuests":"'+e+'"}',success:function(e){console.log(e)},error:function(){console.log("hello")}})}function getCheckedInCust(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),o="/api/guest/getActiveGuest?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,data:'{"hotelId":"'+t+'"}',success:function(e){try{for(var t,o=e,a=o.guests,s=[],n=[],r=0;r<a.length;r++){var d=a[r].checkoutDate;d=d.substr(d.indexOf("-")+1).trim(),d=moment(d),moment().diff(d)>0?s.push(a[r].guestCode):n.push(a[r])}var c,i=0,l="<ul id='checkedInCust' class='users-list clearfix'><li><img src='admin/assets/dist/img/22.png' id='myModal' style='cursor:pointer'><a data-pin-nopin='true'><a class='users-list-name' id='myModal_name' href='#'>Add Guest</a><span class='users-list-date'></span></li>";if(1==o.success){var u=n.length;i=u>=7?u-7:0,document.getElementById("checked-cust").innerHTML="<h3>"+u+"<h3>";for(var m=u-1;m>=i;m--){var g=n[m].status;void 0!==g&&null!=g||(g="ONLINE");var f=n[m].guestCode;c=n[m].name+"&nbsp;&nbsp;#"+n[m].roomNumber,t="true"==n[m].isMale?"admin/assets/dist/img/user1-128x128.jpg":"admin/assets/dist/img/user3-128x128.jpg",l="ONLINE"==g?l+'<li id="guestCode'+f+'"><img src='+t+" alt='User Image' class='context-menu-one' id='"+n[m].guestCode+"' name='"+c+"'><a class='users-list-name' href='#'>"+n[m].name+"</a><span class='users-list-date'><b>RM #:"+n[m].roomNumber+"</b></span></n><span id='guestStatus"+f+"' class='users-list-date'><i class='fa fa-circle text-success'></i><b> "+g+"</b></a></span><a class='users-list-name' href='#' onclick='view_order_summary("+n[m].guestCode+")'>order summary</a>":l+'<li id="guestCode'+f+'"><img src='+t+" alt='User Image' class='context-menu-one' id='"+n[m].guestCode+"' name='"+c+"'><a class='users-list-name' href='#'>"+n[m].name+"</a><span class='users-list-date'><b>RM #:"+n[m].roomNumber+"</b></span></n><span class='users-list-date'><i class='fa fa-circle text-danger'></i><b> "+g+"</b></a></span><a class='users-list-name' href='#' onclick='view_order_summary("+n[m].guestCode+")'>order summary</a>"}document.getElementById("list").innerHTML="</ul>"+l,$("#myModal").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))}),$("#myModal_name").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))})}else{l="<ul class='users-list clearfix'><li><img src='admin/assets/dist/img/22.png' id='myModal' style='cursor:pointer'><a data-pin-nopin='true' ><a class='users-list-name' href='#'>Add Guest</a><span class='users-list-date'></span></li>";document.getElementById("list").innerHTML="</ul>"+l,$("#myModal").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))}),$("#myModal_name").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))})}}catch(e){}s.length>0&&bulkCheckoutGuest(s)},error:function(){}})}function getDashBoardDetails(){if(void 0!=window.localStorage.getItem("token")&&null!=window.localStorage.getItem("token")){var e=window.localStorage.getItem("hotelCodeVal"),t=window.localStorage.getItem("clientId"),o="/api/guest/getDashboardDetail?dept="+window.localStorage.getItem("departmentId")+"&access_token="+window.localStorage.getItem("token")+"&refreshToken=true&clientId="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,data:'{"hotelId":"'+e+'"}',success:function(e){try{var t=e,o=0;if(t.newtoken){window.localStorage.removeItem("token"),window.localStorage.setItem("token",t.newtoken);var a=window.localStorage.getItem("token");window.history.replaceState("","",window.location.pathname+"?access_token="+a)}if(1==t.success){var s=t.dashboard.pendingOrderCount,n=t.dashboard.orderCount,r=t.dashboard.checkedInCustomer,d=t.dashboard.feedbackCount,c=t.dashboard.guests,i=c.length;for($("ul#checkedInCust li").length,o=0;o<i;o++){var l="guestCode"+c[o].guestCode;if($("#"+l).length>0){var u=c[o].status;"ONLINE"==u?$("#guestStatus108").html("<i class='fa fa-circle text-success'></i><b> "+u+"</b>"):$("#guestStatus108").html("<i class='fa fa-circle text-danger'></i><b> "+u+"</b>")}}if(fromDashboard)open_Order_s=t.dashboard.pendingOrderCount,total_Order_s=t.dashboard.orderCount,total_feedback_count_s=t.dashboard.feedbackCount,checkedin_customer_s=t.dashboard.checkedInCustomer;else if(!fromDashboard&&(s>open_Order_s||n>total_Order_s||d>total_feedback_count_s||r>checkedin_customer_s)){loadOrdersForDashboard();var m=new Audio("admin/assets/audio/new-message.wav");if(s>open_Order_s){var g=s-open_Order_s;m.play(),getAllOpenOrders(),notification=new Notification("New Order",{body:"You have "+g+" new order(s)",requireInteraction:!0}),notification.onclick=function(){window.focus(),notification.close(),$("#main-content").load("admin/orders.html?access_token="+window.localStorage.getItem("token"))},setTimeout(function(){notification.close()},2e6)}open_Order_s=t.dashboard.pendingOrderCount,total_Order_s=t.dashboard.orderCount,total_feedback_count_s=t.dashboard.feedbackCount,checkedin_customer_s=t.dashboard.checkedInCustomer,getCheckedInCust()}fromDashboard=!1,document.getElementById("open-order").innerHTML="<h3>"+t.dashboard.pendingOrderCount+"<h3>",document.getElementById("total-order").innerHTML="<h3>"+t.dashboard.orderCount+"<h3>",document.getElementById("total-feedback").innerHTML="<h3>"+t.dashboard.feedbackCount+"<h3>",document.getElementById("checked-cust").innerHTML="<h3>"+t.dashboard.checkedInCustomer+"<h3>",open_Order_s=t.dashboard.pendingOrderCount,total_Order_s=t.dashboard.orderCount,total_feedback_count_s=t.dashboard.feedbackCount,checkedin_customer_s=t.dashboard.checkedInCustomer}}catch(e){}},error:function(){}}),timeout&&clearTimeout(timeout),timeout=setTimeout(getDashBoardDetails,29e3)}}function checkAndNotifyopenOrderThroughSMS(){var e=window.localStorage.getItem("staff_mobile"),t=window.localStorage.getItem("token"),o=window.localStorage.getItem("hotelCodeVal"),a="/admin/api/hotel/getOrdersToNotify?access_token="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:a,async:!1,data:'{"hotelCode":  '+o+',"staffId":'+staffId+"}",success:function(o){try{if(1==o.success&&o.count>0)try{$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"/api/guest/sendSMSForPendingOrders?access_token="+t,async:!1,data:'{"mobile":'+e+"}",success:function(e){},error:function(e,t,o){}})}catch(e){}}catch(e){}},error:function(){}}),checkAndNotifyTimout&&clearTimeout(checkAndNotifyTimout),checkAndNotifyTimout=setTimeout(checkAndNotifyopenOrderThroughSMS,3e5)}function signOut(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("clientId");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"/api/clients/logout?access_token="+e,data:'{"clientId":'+t+"}",success:function(e){try{1==e.success&&(window.localStorage.clear(),window.location.href="/../admin/login.html")}catch(e){}},error:function(e,t){}})}function pushNote(){$.contextMenu({selector:".context-menu-one",callback:function(e,t){var o=$(this).attr("name"),a=$(this).attr("id");"send"===e?(document.getElementById("guestid").value=a,$(".modal-title").html("Send Notification To "+o),document.getElementById("notification-div").style.display="block"):"Checkout"===e&&checkoutGuest(a)},items:{send:{name:"Send Notification"},Checkout:{name:"Checkout",icon:function(){return"context-menu-icon"}}}}),$(".context-menu-one").on("click",function(e){console.log("clicked",this)}),$("#closebtn").click(function(){$("#msg_title").val(""),$("#messages").val(""),document.getElementById("notification-div").style.display="none"}),$("#closeNotify").click(function(){$("#msg_title").val(""),$("#messages").val(""),document.getElementById("notification-div").style.display="none"}),$("#pushMsg").on("click",function(e){$.trim($("#msg_title").val())?$.trim($("#messages").val())?sendPushMsgtoClient():$("#messages").focus():$("#msg_title").focus()}),$("#send_to_all").click(function(){document.getElementById("notification-div").style.display="block",$("#msg_title").val(""),$("#messages").val(""),$(".modal-title").html("Send Notification To All")})}function sendPushMsgtoClient(){var e,t=window.localStorage.getItem("token"),o=window.localStorage.getItem("hotelCodeVal"),a=$.trim($("#guestid").val()),s=$.trim($("#msg_title").val()),n=$.trim($("#messages").val());e=a?{hotelId:o,guestId:a,title:s,msg:n}:{hotelId:o,title:s,msg:n};var r=JSON.stringify(e),d="api/guest/pushNotification?access_token="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:d,data:r,success:function(e){try{1==e.success?($("#msg_title").val(""),$("#messages").val(""),$("#guestid").val(""),toastr.success("Message sent successfully"),document.getElementById("notification-div").style.display="none"):console.log("inserted count is: "+e.insertedCount)}catch(e){$("#msg_title").val(""),$("#messages").val(""),$("#guestid").val(""),toastr.error("failed"),document.getElementById("notification-div").style.display="none"}},error:function(){$("#msg_title").val(""),$("#messages").val(""),$("#guestid").val(""),toastr.error("Message sent failed"),document.getElementById("notification-div").style.display="none"}})}function loadOrdersForDashboard(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("clientId"),o=window.localStorage.getItem("hotelCodeVal"),a="/admin/api/hotel/getAllOrder?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:a,data:'{"staffId":'+t+',"hotelCode":'+o+"}",success:function(e){try{if(1==e.success){for(var t="<table class=table no-margin'><thead><tr><th>Room #</th><th>Items</th><th>Status</th><th>Time</th><th>Action</th></tr></thead><tbody>",o=0,a=[],s=[],n=e.orders,r=0;r<e.orders.length;r++){var d=n[r].guest.guestCode,c=n[r].guest.roomNumber;for(k=0;k<n[r].order.length;k++){var i=JSON.parse(JSON.stringify(n[r].order[k]));i.roomNo=c,i.guestCode=d,a.push(i),s.push(n[r].guest.roomNumber)}}var l=JSON.parse(JSON.stringify(a));o=0;l.sort(function(e,t){return moment(t.orderDate,"MMM DD YYYY, h:mm:ss a")-moment(e.orderDate,"MMM DD YYYY, h:mm:ss a")});for(var u=0;u<a.length&&!(o>=7);u++){var m="";for(k=0;k<l[u].items.length;k++)m+=l[u].items[k].itemName+", ";(m=m.substring(0,m.length-2)).length>12&&(m=m.substring(0,12)+"...");var g=l[u].orderStatus,f="",h="",p=moment(new Date(l[u].orderDate+" UTC")).format("MMM DD, hh:mm:ss a").toString();"Completed"!=g&&(o++,f="<span class='label label-success'>Completed</span>","Inprogress"==g&&(f="<span class='label label-info'>In progress</span>",h="<a style='cursor:pointer' class='label label-info' onclick=\"performOrderClose('"+l[u].orderId+"','"+l[u].guestCode+"')\">Close</a>"),"Initialize"==g&&(f="<span class='label label-danger'>Open</span>",h="<a style='cursor:pointer' class='label label-info' onclick=\"performOrderAccept('"+l[u].orderId+"','"+l[u].guestCode+"')\">Accept</a>"),t=t+"<tr><td>"+l[u].roomNo+"</td><td>"+m+"</td><td>"+f+"</td><td>"+p+"</td><td>"+h+"</td></tr>")}t+="</tbody></table>",document.getElementById("dashboard-order-box").innerHTML=t}else document.getElementById("dashboard-order-box").innerHTML="<span><center>Unable to load Orders</center></span>"}catch(e){}},error:function(){}})}function performOrderClose(e,t){var o="/api/guest/completeOrder?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,data:'{"userCode": '+t+',"orderId": '+e+',"staffId": '+staffId+',"staffName": "'+staffName+'","remark": "Good Service"}',success:function(e){try{1==e.success&&(toastr.success("Order completed"),loadOrdersForDashboard(),getDashBoardDetails())}catch(e){toastr.success("Failed to complete order")}},error:function(){}})}function performOrderAccept(e,t){var o="/api/guest/assignStaff?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,async:!1,data:'{"userCode": '+t+',"orderId": '+e+',"staffId": '+staffId+',"staffName": "'+staffName+'"}',success:function(e){try{1==e.success?(toastr.success("Order accepted"),loadOrdersForDashboard(),getDashBoardDetails()):toastr.error("failed to accept order")}catch(e){}},error:function(e,t){}})}function checkoutGuest(e){var t="/api/guest/chekoutGuest?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t,async:!1,data:'{"userCode": '+e+"}",success:function(e){try{1==e.success?(toastr.success("Guest checked-out successfully"),getCheckedInCust()):toastr.error("Guest checked-out failed")}catch(e){}},error:function(e,t){}})}function view_order_summary(e){isValidToken(),$("#main-content").load("admin/order-sumary.html?access_token="+window.localStorage.getItem("token")),setTimeout(function(){var t="/api/guest/getOrderListByGuestId?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t,data:'{"guestId":'+e+"}",success:function(e){try{var t="";if(e&&e.guest&&(t+="<tr>",t+="<td>"+e.guest.guestCode+"</td>",t+="<td>"+e.guest.guestName+"</td>",t+="<td>"+e.guest.roomNumber+"</td>",t+="<td>"+e.guest.mobile+"</td>",t+="<td>"+e.guest.checkinDate+"</td>",t+="</tr>"),document.getElementById("guestDetailId").innerHTML=t,e&&e.order){for(var o="",a=1,s=0,n=0;n<e.order.length;n++)if(e.order[n].items&&Array.isArray(e.order[n].items)){for(var r=0;r<e.order[n].items.length;r++){var d=0,c=e.order[n].items[r].qty*e.order[n].items[r].amount*e.order[n].items[r].sgst/100;isNaN(c)&&(c=0);var i=e.order[n].items[r].qty*e.order[n].items[r].amount*e.order[n].items[r].cgst/100;isNaN(i)&&(i=0),s+=d=e.order[n].items[r].qty*e.order[n].items[r].amount+(i+c),o+="<tr>",o+="<td>"+a+++"</td>",o+="<td>"+e.order[n].items[r].itemName+"</td>",o+="<td>"+e.order[n].orderStatus+"</td>",o+="<td>"+e.order[n].orderDate+"</td>",o+="<td>"+e.order[n].items[r].qty+"</td>",o+="<td>"+e.order[n].items[r].amount+"</td>",o+="<td>"+(e.order[n].items[r].qty*e.order[n].items[r].amount).toFixed(2)+"</td>",o+="<td>"+c.toFixed(2)+"</td>",o+="<td>"+i.toFixed(2)+"</td>",o+="<td>"+d.toFixed(2)+"</td>",o+="</tr>"}o+="<tr>",o+="<th colspan=9> Grand Total Amount (In Rupees)</th>",o+="<th>"+s.toFixed(2)+"</th>",o+="</tr>"}document.getElementById("myOrderId").innerHTML=o}}catch(e){}},error:function(){}},2e3)})}
var addSubitemRow=1,countForEditItem=1;function loadDeptsByHotelCodeForService(){countForEditItem=1,$("#serviceTitle").text("Services");var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),i="/admin/api/hotel/getDepartmentOfHotel?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:i,data:'{"hotelCode": '+t+"}",success:function(e){console.log(e);try{if(1==e.success){$("#department").html(""),$("#department").append("<option value=''>Select</option>"),$("#editDepartment").html(""),$("#editDepartment").append("<option value=''>Select</option>");for(var t=0;t<e.res.length;t++)$("#department").append("<option value='"+e.res[t].departmentId+"'>"+e.res[t].name+"</option>"),$("#editDepartment").append("<option value='"+e.res[t].departmentId+"'>"+e.res[t].name+"</option>");getHotelDetailsByHotelCode(),getHotelDetailsByHotelCodeForServiceGrid()}else console.log("Can not get depts: "+e.err)}catch(e){}},error:function(e,t){console.log(e.status),console.log(e.statusText),console.log(e.responseText)}}),$("#add_row").click(function(){$("#addr"+addSubitemRow).html("");var e="<tr id='addr"+addSubitemRow+"'><td>"+(addSubitemRow+1)+"</td><td><input name='subItemName"+addSubitemRow+"' id='subItemName"+addSubitemRow+"' type='text' placeholder='Enter Sub Item Name' class='subItemNameCls'/></td><td><input name='subItemQuantity"+addSubitemRow+"' id='subItemQuantity"+addSubitemRow+"' type='text' placeholder='Enter Sub Item Quantity' class='form-control'/></td><td><input name='subItemPrice"+addSubitemRow+"' id='subItemPrice"+addSubitemRow+"' type='text' placeholder='Enter Sub Item Price' class='form-control'/></td></tr>";$("#tab_logic").append(e),addSubitemRow++,$(".subItemNameCls").each(function(){$(this).rules("add",{required:!0,messages:{required:"Required !"}})})}),$("#delete_row").click(function(){addSubitemRow>1&&(document.getElementById("tab_logic").deleteRow(addSubitemRow),addSubitemRow--)}),$("#edit_add_row").click(function(){var e="<tr id='editaddr"+countForEditItem+"'><td>"+countForEditItem+"</td><td><input name='editSubItemName"+countForEditItem+"' id='editSubItemName"+countForEditItem+"' type='text' placeholder='Enter Sub Item Name' class='subItemNameCls'/></td><td><input name='editSubItemQuantity"+countForEditItem+"' id='editSubItemQuantity"+countForEditItem+"' type='text' placeholder='Enter Sub Item Quantity' class='form-control'/></td><td><input name='editSubItemPrice"+countForEditItem+"' id='editSubItemPrice"+countForEditItem+"' type='text' placeholder='Enter Sub Item Price' class='form-control'/></td></tr>";$("#edit_tab_logic").append(e),countForEditItem++,$(".subItemNameCls").each(function(){$(this).rules("add",{required:!0,messages:{required:"Required !"}})})}),$("#edit_delete_row").click(function(){countForEditItem>1&&(document.getElementById("edit_tab_logic").deleteRow(countForEditItem-1),countForEditItem--)}),$("#startTime").timepicker(),$("#endTime").timepicker(),$("#editStartTime").timepicker(),$("#editEndTime").timepicker()}function getHotelDetailsByHotelCode(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),i="/admin/api/hotel/getHotelDetail?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:i,data:'{"hotelId": '+t+"}",success:function(e){console.log(e);try{if(1==e.success)if(null==e.hotel.services){var t="<table id='display_services_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Service Name</th><th>Timing</th><th>Action</th></tr></thead><tbody>";t+="</tbody></table>",document.getElementById("service-data-table").innerHTML=t,$("#display_services_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else{for(var i=e.hotel.services,a=(t="<table id='display_services_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Service Name</th><th>Timing</th><th>Action</th></tr></thead><tbody>",0);a<i.length;a++)t=t+"<tr><td>"+(a+1)+"</td><td>"+i[a].name+"</td><td>"+i[a].timing+"</td><td><a class='users-list-name' href='#'onclick='showServiceRecordForEdit("+JSON.stringify(i[a])+")'><span class='glyphicon glyphicon-edit'></span></tr>";t+="</tbody></table>",document.getElementById("service-data-table").innerHTML=t,$("#display_services_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else console.log("Can not get depts: "+e.err)}catch(e){console.log("error"+e)}},error:function(e,t){}})}var serviceId=0,serviceRecordForEdit="",showServiceRecordForEdit=function(e){serviceRecordForEdit=e,$("#service_title").text("Update Services"),$("#editDepartment").val(e.departmentId),$("#editServiceName").val(e.name),$("#editServiceDesc").val(e.desc),$("#editCGST").val(e.cgst),$("#editSGST").val(e.sgst),$("#editOtherTax").val(e.otherTax),"true"==e.isDeliverable?$("#editIsDeliverable").prop("checked",!0):$("#editIsDeliverable").prop("checked",!1),serviceId=e.id;var t=e.timing.split(" - ");$("#editStartTime").val(t[0]),$("#editEndTime").val(t[1]),""==e.thumbnail||0==e.thumbnail.length||($("#editSelectedImage").html("<img width=10% style=margin-left:25%;margin-top:-7%; src=/images/service-icon/"+e.thumbnail+">"),$("#edit_service_thumbnail").val(e.thumbnail)),""==e.background||0==e.background.length||($("#edit_bkg_selectedImage").html("<img width=10% style=margin-left:25%;margin-top:-7%; src=/images/service-background/"+e.background+">"),$("#edit_bkimgs_thumbnail").val(e.background)),$("#add-service").css("display","none"),$("#update-service").css("display","block")};function updateServices(){event.preventDefault();var e=window.localStorage.getItem("hotelCodeVal"),t=window.localStorage.getItem("token"),i=serviceRecordForEdit.departmentId,a=serviceRecordForEdit.name,d=serviceRecordForEdit.desc,o=serviceRecordForEdit.isDeliverable,l=serviceRecordForEdit.timing,s=serviceRecordForEdit.thumbnail,r=serviceRecordForEdit.background,c=serviceRecordForEdit.sgst,n=serviceRecordForEdit.cgst,m=serviceRecordForEdit.otherTax,u=$("#editDepartment :selected").val(),v=$("#editServiceName").val().trim(),h=$("#editServiceDesc").val().trim(),p=$("#editIsDeliverable:checked").is(":checked"),g=$("#editStartTime").val().trim()+" - "+$("#editEndTime").val().trim(),b=$("#edit_service_thumbnail").val().trim(),y=$("#edit_bkimgs_thumbnail").val().trim(),I=$("#editSGST").val().trim(),S=$("#editCGST").val().trim(),f=$("#editOtherTax").val().trim(),_="/admin/api/hotel/updateService?access_token="+t;i!=u||a!=v||d!=h||o+""!=p+""||l!=g||s!=b||r!=y||c!=I||n!=S||f!=m?(console.log(_),console.log('{"hotelCode":'+e+',"serviceId":'+serviceId+',"name":"'+v+'","departmentId":"'+u+'","desc":"'+h+'","isDeliverable":"'+p+'","timing":"'+g+'","background":"'+y+'","cgst":"'+S+'","sgst":"'+I+'","otherTax":"'+f+'","thumbnail":"'+b+'"}'),$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:_,data:'{"hotelCode":'+e+',"serviceId":'+serviceId+',"name":"'+v+'","departmentId":"'+u+'","desc":"'+h+'","isDeliverable":"'+p+'","timing":"'+g+'","background":"'+y+'","cgst":"'+S+'","sgst":"'+I+'","otherTax":"'+f+'","thumbnail":"'+b+'"}',success:function(e){console.log("browser json"+e);try{1==e.success?(document.getElementById("update-service").reset(),$("#edit_cancel_vc_modal").click(),$("#edit_bkimgs_cancel_vc_modal").click(),toastr.success("Service successfully updated"),$("#service_title").text("Add Services"),$("#add-service").css("display","block"),$("#update-service").css("display","none"),getHotelDetailsByHotelCode()):(toastr.error("Service not updated"),console.log("inserted count is: "+e.insertedCount))}catch(e){toastr.error("Service not updated")}},error:function(e,t){toastr.error("Service not updated")}})):toastr.error("Invalid operation modify atleast one data")}function getHotelDetailsByHotelCodeForServiceGrid(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),i="/admin/api/hotel/getHotelDetail?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:i,data:'{"hotelId": '+t+"}",success:function(e){console.log(e);try{if(1==e.success)if(null==e.hotel.services){var t="<div class='col-lg-3 col-xs-6'><div class='small-box bg-aqua'><div class='inner'><div class='row-fluid' id='checked-cust' style='width: 70%'><input type='hidden' name='serviceId' id='serviceId'><input type='hidden' name='serviceName' id='serviceName'><a href=# rel='tooltip' title='' class='small-box-footer' style='text-decoration:none' id='showAddServiceDiv'><h3 class='heading' style='color:#FFF;font-size: 30px'>Add Service<sup style='font-size: 20px'></h3></a></div><p style='color:#00C0Ef'>.</p></div><div class='icon'><i class='ion-ios-plus' style='cursor:pointer;' onclick='showAddServiceDivFun()'></i></div><a href=# class='small-box-footer' onclick=showAddServiceDivFun()>Add Service <i class='fa fa-arrow-circle-right'></i></a></div></div>";document.getElementById("list").innerHTML=t,$("#showAddServiceDiv").click(function(){$("#serviceTitle").text("Services"),$("#service_grid").css("display","none"),$("#add_service_hotel").css("display","block")})}else{t="<div class='col-lg-3 col-xs-6'><div class='small-box bg-aqua'><div class='inner'><div class='row-fluid' id='checked-cust' style='width: 70%'><input type='hidden' name='serviceId' id='serviceId'><input type='hidden' name='serviceName' id='serviceName'><a href=# rel='tooltip' title='' class='small-box-footer' style='text-decoration:none' id='showAddServiceDiv'><h3 class='heading' style='color:#FFF;font-size: 30px'>Add Service<sup style='font-size: 20px'></h3></a></div><p style='color:#00C0Ef'>.</p></div><div class='icon'><i class='ion-ios-plus' style='cursor:pointer;' onclick='showAddServiceDivFun()'></i></div><a href=# class='small-box-footer' onclick=showAddServiceDivFun()>Add Service <i class='fa fa-arrow-circle-right'></i></a></div></div>";for(var i=e.hotel.services,a=0;a<i.length;a++){var d="";d=i[a].name.length<=9?i[a].name:i[a].name.substring(0,7)+"...",t="HOUSE-KEEPING"==i[a].name||"MAINTENANCE"==i[a].name?t+"<div class='col-lg-3 col-xs-6'><div class='small-box bg-aqua'><div class='inner'><div class='row-fluid' id='checked-cust' style='width: 70%'><input type='hidden' name='serviceId"+a+"' id='serviceId"+a+"' value='"+i[a].id+"'><input type='hidden' name='serviceName"+a+"' id='serviceName"+a+"' value='"+i[a].name+"'><a href=# rel='tooltip' title='"+i[a].name+"' class='small-box-footer' style='text-decoration:none' onclick=showSubitems('"+a+"')><h3 class='heading' style='color:#FFF;font-size: 30px'>"+d+"<sup style='font-size: 20px'></h3></a></div><p>"+i[a].timing+"</p></div><div class='icon'><i class='ion-ios-paper' style='cursor:pointer;' onclick=showitems('"+a+"')></i></div><a class='small-box-footer' style='cursor:default;'>Create Offer <i class='fa fa-arrow-circle-right'></i></a></div></div>":t+"<div class='col-lg-3 col-xs-6'><div class='small-box bg-aqua'><div class='inner'><div class='row-fluid' id='checked-cust' style='width: 70%'><input type='hidden' name='serviceId"+a+"' id='serviceId"+a+"' value='"+i[a].id+"'><input type='hidden' name='serviceName"+a+"' id='serviceName"+a+"' value='"+i[a].name+"'><a href=# rel='tooltip' title='"+i[a].name+"' class='small-box-footer' style='text-decoration:none' onclick=showSubitems('"+a+"')><h3 class='heading' style='color:#FFF;font-size: 30px'>"+d+"<sup style='font-size: 20px'></h3></a></div><p>"+i[a].timing+"</p></div><div class='icon'><i class='ion-ios-paper' style='cursor:pointer;' onclick=showitems('"+a+"')></i></div><a href=# class='small-box-footer' onclick=createOffer('"+a+"')>Create Offer <i class='fa fa-arrow-circle-right'></i></a></div></div>"}document.getElementById("list").innerHTML=t,$("#showAddServiceDiv").click(function(){$("#serviceTitle").text("Services"),$("#service_grid").css("display","none"),$("#add_service_hotel").css("display","block")}),$('[rel="tooltip"]').tooltip()}else console.log("Can not get depts: "+e.err)}catch(e){console.log("error"+e)}},error:function(e,t){console.log(e.status),console.log(e.statusText),console.log(e.responseText)}})}function showAddServiceDivFun(){$("#serviceTitle").text("Services"),$("#service_grid").css("display","none"),$("#add_service_hotel").css("display","block")}function createOffer(e){var t=$("#serviceName"+e).val(),i=$("#serviceId"+e).val();window.localStorage.setItem("offerServiceId",null),window.localStorage.setItem("offerServiceName",null),window.localStorage.setItem("offerShowType",null),window.localStorage.setItem("offerServiceId",i),window.localStorage.setItem("offerServiceName",t),window.localStorage.setItem("offerShowType","add"),$("#main-content").load("admin/offer.html")}function showitems(e){var t=$("#serviceName"+e).val(),i=$("#serviceId"+e).val();$("#serviceTitle").text(t);var a=window.localStorage.getItem("token"),d=window.localStorage.getItem("hotelCodeVal"),o="/admin/api/hotel/getServiceItemsByserviceId?access_token="+a;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,data:'{"hotelCode": '+d+',"serviceId":'+i+"}",success:function(e){console.log(e);try{if(1==e.success)if(null==e.serviceItems){var a="<table id='display_item_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Item Name</th><th>Item Desc</th><th>Item Quantity</th><th>Item Unit</th><th>Action</th></tr></thead><tbody>";a+="</tbody></table>",document.getElementById("display_item_table").innerHTML=a,document.getElementById("service_grid").style.display="none",document.getElementById("display_item_div").style.display="block",$("#display_item_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else{for(var d=e.serviceItems,o=(a="<table id='display_item_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Item Name</th><th>Item Desc</th><th>Item Quantity</th><th>Item Unit</th><th>Action</th></tr></thead><tbody>",0);o<d.length;o++)a=a+"<tr><td>"+(o+1)+"</td><td>"+d[o].name+"</td><td>"+d[o].desc+"</td><td>"+d[o].qty+"</td><td>"+d[o].unit+"</td><td><a class='users-list-name' href='#'onclick='showSubitemDiv("+JSON.stringify(d[o])+")'><input type='image' src='admin/assets/dist/img/View_Details.png'width='15' height='15'><div class='vcenter'><a class='users-list-name' href='#'onclick='showRecordForItemEdit("+(o+1)+", "+JSON.stringify(d[o])+", "+i+', "'+t+"\")'><span class='glyphicon glyphicon-edit'></span></div></td></tr>";a+="</tbody></table>",$("#item-data-table").html(a),document.getElementById("view_item").style.display="block",document.getElementById("display_item_div").style.display="block",document.getElementById("service_grid").style.display="none",$("#display_item_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else console.log("Can not get depts: "+e.err)}catch(e){console.log("error"+e)}},error:function(e,t){console.log(e.status),console.log(e.statusText),console.log(e.responseText)}})}function showSubitemDiv(e){var t=e.item;if(0==t.length){var i="<table id='display_subitem_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Sub Item Name</th><th>Sub Item Quantity</th><th>Sub Item Price</th></tr></thead><tbody>";i+="</tbody></table>",document.getElementById("display_subitem_table").innerHTML=i,document.getElementById("service_grid").style.display="none",document.getElementById("display_subitem_div").style.display="block",$("#display_subitem_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else{i="<table id='display_subitem_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Sub Item Name</th><th>Sub Item Quantity</th><th>Sub Item Price</th></tr></thead><tbody>";for(var a=0;a<t.length;a++)i=i+"<tr><td>"+(a+1)+"</td><td>"+t[a].name+"</td><td>"+t[a].qty+"</td><td>"+t[a].price+"</td></tr>";i+="</tbody></table>",document.getElementById("display_subitem_table").innerHTML=i,document.getElementById("service_grid").style.display="none",document.getElementById("display_subitem_div").style.display="block",$.fn.DataTable.isDataTable("#display_subitem_table")&&$("#display_subitem_table").DataTable().destroy(),$("#display_subitem_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}}var serviceItemForEdit="";function showRecordForItemEdit(e,t,i,a){serviceItemForEdit=t,$("#editServiceId").val(i),$("#editServiceItemId").val(t.serviceItemId),$("#editItemName").val(t.name),$("#editItemDesc").val(t.desc),$("#editItemQuantity").val(t.qty),$("#editItemUnit").val(t.unit);var d=t.item,o=d.length;if(o>=1){countForEditItem=1;for(var l="",s=0;s<o;s++)l+="<tr id='editaddr"+countForEditItem+"'><td>"+countForEditItem+"</td><td><input name='editSubItemName"+countForEditItem+"' id='editSubItemName"+countForEditItem+"' type='text' placeholder='Enter Sub Item Name' class='subItemNameCls' value='"+d[s].name+"'/></td><td><input name='editSubItemQuantity"+countForEditItem+"' id='editSubItemQuantity"+countForEditItem+"' type='text' placeholder='Enter Sub Item Quantity' class='form-control' value='"+d[s].qty+"'/></td><td><input name='editSubItemPrice"+countForEditItem+"' id='editSubItemPrice"+countForEditItem+"' type='text' placeholder='Enter Sub Item Price' class='form-control' value='"+d[s].price+"'/></td></tr>",$("#edit_tab_logic").append(l),countForEditItem++,$(".subItemNameCls").each(function(){$(this).rules("add",{required:!0,messages:{required:"Required !"}})}),1==s&&($("#editSubItemName"+(s-1)).val(d[s-1].name),$("#editSubItemQuantity"+(s-1)).val(d[s-1].qty),$("#editSubItemPrice"+(s-1)).val(d[s-1].price));$("#edit_tab_logic").html("");var r="<table class=table table-bordered table-hover id=edit_tab_logic><thead><tr><th class=text-center>#</th><th class=text-center>Sub Item Name</th><th class=text-center>Quantity</th><th class=text-center>Price</th></tr></thead><tbody>"+l+"</tbody></table>";document.getElementById("edit_tab_logic_div").innerHTML=r}else 1==o&&($("#editSubItemName0").val(d[0].name),$("#editSubItemQuantity0").val(d[0].qty),$("#editSubItemPrice0").val(d[0].price));$(".subItemNameCls").each(function(){$(this).rules("add",{required:!0,messages:{required:"Required !"}})}),$("#serviceTitle").text(a),$("#item-form-title").text("Update Items"),$("#service_grid").css("display","none"),$("#display_subitem_div").css("display","none"),$("#view_item").css("display","none"),$("#add-item").css("display","none"),$("#add_subitem").css("display","block"),$("#update-item").css("display","block")}function addServices(){event.preventDefault();var e=window.localStorage.getItem("hotelCodeVal"),t=window.localStorage.getItem("token"),i=$("#department :selected").val(),a=$("#serviceName").val().trim(),d=$("#serviceDesc").val().trim(),o=$("#isDeliverable:checked").is(":checked"),l=$("#startTime").val().trim()+" - "+$("#endTime").val().trim(),s=$("#service_thumbnail").val().trim(),r=$("#bkimgs_thumbnail").val().trim(),c=$("#SGST").val().trim(),n=$("#CGST").val().trim(),m=$("#otherTax").val().trim(),u="admin/api/hotel/addServiceToHotel?access_token="+t;console.log("url : "+u),console.log('{"hotelCode":'+e+',"name":"'+a+'","departmentId":"'+i+'","desc":"'+d+'","isDeliverable":"'+o+'","timing":"'+l+'","background":"'+r+'","sgst":"'+c+'","cgst":"'+n+'","otherTax":"'+m+'","thumbnail":"'+s+'"}'),$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:u,data:'{"hotelCode":'+e+',"name":"'+a+'","departmentId":"'+i+'","desc":"'+d+'","isDeliverable":"'+o+'","timing":"'+l+'","background":"'+r+'","sgst":"'+c+'","cgst":"'+n+'","otherTax":"'+m+'","thumbnail":"'+s+'"}',success:function(e){console.log("browser json"+e);try{var t=e;1==t.success?(document.getElementById("add-service").reset(),$("#cancel_vc_modal").click(),$("#bkimgs_cancel_vc_modal").click(),toastr.success("Service successfully added"),getHotelDetailsByHotelCode()):(toastr.error(t.err),console.log("inserted count is: "+e.insertedCount))}catch(e){toastr.error("Service not added")}},error:function(e,t){toastr.error("Service not added")}})}function showSubitems(e){var t=document.getElementById("tab_logic").rows.length;if(t>2)for(var a=t;a>2;a--)document.getElementById("tab_logic").deleteRow(a-1);i=1;var d=$("#serviceName"+e).val(),o=$("#serviceId"+e).val();$("#serviceTitle").text(d),$("#serviceId").val(o),document.getElementById("service_grid").style.display="none",document.getElementById("add_service_hotel").style.display="none",document.getElementById("add_subitem").style.display="block",$(".subItemNameCls").each(function(){$(this).rules("add",{required:!0,messages:{required:"Required !"}})})}function addSubitems(){event.preventDefault();for(var e=window.localStorage.getItem("hotelCodeVal"),t=window.localStorage.getItem("token"),i=$("#serviceId").val().trim(),a=$("#itemName").val().trim(),d=$("#itemDesc").val().trim(),o=$("#itemQuantity").val().trim(),l=$("#itemUnit").val().trim(),s=$("#tab_logic tr").length,r=[],c=[],n=[],m=0;m<s-1;m++)r[m]=$("#subItemName"+m).val().trim(),c[m]=$("#subItemQuantity"+m).val().trim(),n[m]=$("#subItemPrice"+m).val().trim();var u="admin/api/hotel/addServiceItemsToHotel?access_token="+t,v='{"hotelCode":'+e+',"serviceId":'+i+',"serviceItems":[',h='{"name":"'+a+'" ,"desc": "'+d+'","qty": "'+o+'","unit":"'+l+'",',p='"item":[',g="";for(m=0;m<r.length;m++)g=m==r.length-1?g+'{"name":"'+r[m]+'" ,"qty": "'+c[m]+'","price":"'+n[m]+'"}':g+'{"name":"'+r[m]+'" ,"qty": "'+c[m]+'","price":"'+n[m]+'"},';console.log(v+h+p+g+"]}]}"),$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:u,data:v+h+p+g+"]}]}",success:function(e){console.log("browser json"+e);try{var t=e;1==t.success?(toastr.success("Service sub-item successfully added"),document.getElementById("add-item").reset(),getHotelDetailsByHotelCodeForServiceGrid(),document.getElementById("add_subitem").style.display="none",document.getElementById("service_grid").style.display="block"):(toastr.error(t.err),console.log("inserted count is: "+e.insertedCount))}catch(e){toastr.error("Service sub-item not added")}},error:function(e,t){toastr.error("Service sub-item not added")}})}function updateSubitems(){event.preventDefault();for(var e=window.localStorage.getItem("hotelCodeVal"),t=window.localStorage.getItem("token"),i=$("#editServiceId").val().trim(),a=$("#editServiceItemId").val().trim(),d=$("#editItemName").val().trim(),o=$("#editItemDesc").val().trim(),l=$("#editItemQuantity").val().trim(),s=$("#editItemUnit").val().trim(),r=$("#edit_tab_logic tr").length,c=[],n=[],m=[],u=1;u<r;u++)c[u]=$("#editSubItemName"+u).val(),n[u]=$("#editSubItemQuantity"+u).val(),m[u]=$("#editSubItemPrice"+u).val();var v="admin/api/hotel/updateServiceItemsToHotel?access_token="+t,h='{"hotelCode":'+e+',"serviceId":'+i+',"serviceItemId":'+a+',"serviceItems":[',p='{"name":"'+d+'" ,"desc": "'+o+'","qty": "'+l+'","unit":"'+s+'",',g='"item":[',b="";for(u=1;u<c.length;u++)b=u==c.length-1?b+'{"name":"'+c[u]+'" ,"qty": "'+n[u]+'","price":"'+m[u]+'"}':b+'{"name":"'+c[u]+'" ,"qty": "'+n[u]+'","price":"'+m[u]+'"},';console.log(h+p+g+b+"]}]}"),$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:v,data:h+p+g+b+"]}]}",success:function(e){console.log("browser json"+e);try{1==e.success?(toastr.success("Service sub-item successfully updated"),$("#display_item_table").DataTable().destroy(),$("#serviceTitle").text("services"),document.getElementById("update-item").reset(),getHotelDetailsByHotelCodeForServiceGrid(),document.getElementById("add_subitem").style.display="none",document.getElementById("service_grid").style.display="block"):(toastr.error("Service sub-item not update"),console.log("inserted count is: "+e.insertedCount))}catch(e){toastr.error("Service sub-item not update")}},error:function(e,t){toastr.error("Service sub-item not update")}})}function viewAllSubitems(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),i="/admin/api/hotel/getHotelDetail?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:i,data:'{"hotelId": '+t+"}",success:function(e){console.log(e);try{if(1==e.success)if(null==e.hotel.services){var t="<table id='display_fullitem_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Service Name</th><th>Timing</th></tr></thead><tbody>";t+="</tbody></table>",document.getElementById("fullitem-data-table").innerHTML=t,$("#display_fullitem_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else{for(var i=e.hotel.services,a=(t="<table id='display_fullitem_table' class='table table-bordered table-striped'><thead><tr><th>#</th><th>Service Name</th><th>Service Desc</th><th>Is Deliverable</th><th>Thumnail</th><th>Timing</th><th>Item Name</th><th>Item Desc</th><th>Item Quantity</th><th>Item Unit</th><th>Sub Item Name</th><th>Sub Item Quantity</th><th>Sub Item Price</th></tr></thead><tbody>",0);a<i.length;a++)for(var d=i[a].serviceItems,o=0;o<d.length;o++)for(var l=d[o].item,s=0;s<l.length;s++)t=t+"<tr><td>"+(a+1)+"</td><td>"+i[a].name+"</td><td>"+i[a].desc+"</td><td>"+i[a].isDeliverable+"</td><td>"+i[a].thumbnail+"</td><td>"+i[a].timing+"</td><td>"+d[o].name+"</td><td>"+d[o].desc+"</td><td>"+d[o].qty+"</td><td>"+d[o].unit+"</td><td>"+l[s].name+"</td><td>"+l[s].qty+"</td><td>"+l[s].price+"</td></tr>";t+="</tbody></table>",document.getElementById("fullitem-data-table").innerHTML=t,document.getElementById("display_fullitem_div").style.display="block",$("#display_fullitem_table").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else console.log("Can not get depts: "+e.err)}catch(e){console.log("error"+e)}},error:function(e,t){console.log(e.status),console.log(e.statusText),console.log(e.responseText)}})}
function phonenumber(){var e=document.getElementsByName("guestMob")[0].value.trim();e.substring(e.length-1,e.length).match(/^[0-9]$/)||(e=e.substring(0,e.length-1),document.getElementById("guestMob").value=e,isNaN(document.getElementById("guestMob").value)&&(document.getElementById("guestMob").value=""))}function guestAdd(){event.preventDefault();var e=window.localStorage.getItem("hotelCodeVal"),t=window.localStorage.getItem("token"),a=document.getElementsByName("roomNo")[0].value.trim(),o=document.getElementsByName("guestMob")[0].value.trim(),s=document.getElementsByName("guestName")[0].value.trim(),u=document.getElementsByName("checkOut")[0].value.trim(),d=document.getElementById("male").checked,n="api/guest/addGuest?access_token="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:n,data:'{"roomNumber":"'+a+'","hotelId":"'+e+'","mobile":"'+o+'","name":"'+s+'","checkoutDate":"'+u+'","isMale":"'+d+'"}',success:function(e){try{1==e.success?(toastr.success("Guest successfully added"),$("#roomNo").val(""),$("#guestMob").val(""),$("#guestName").val(""),$("#checkOut").val(""),updateGuestList()):console.log("inserted count is: "+e.insertedCount)}catch(e){toastr.error("Guest addition failed")}},error:function(){toastr.error("Guest addition failed")}})}function updateGuestList(){var e=window.localStorage.getItem("hotelCodeVal"),t="api/guest/getAllGuest?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t,data:'{"hotelId":"'+e+'"}',success:function(e){try{var t=e,a=0;if(1==t.success){for(var o="<table id=example2 class='table table-bordered table-striped'><thead><tr><th>#</th><th>Guest Name</th><th>Room No</th><th>Guest Code</th><th>Action</th></tr></thead><tbody>",s=t.guests.length-1;s>=0;s--)0!=t.guests[s].isManualCheckout&&null!=t.guests[s].isManualCheckout||(o=o+"<tr><td>"+ ++a+"</td><td>"+t.guests[s].name+"</td><td>"+t.guests[s].roomNumber+"</td><td>"+t.guests[s].name.substring(0,2).toLowerCase()+t.guests[s].guestCode+"</td><td><a class='users-list-name' href='#'onclick='recordForEdit("+JSON.stringify(t.guests[s])+")'><span class='glyphicon glyphicon-edit'></span></tr>");o+="</tbody></table>",document.getElementById("guest-data-table").innerHTML=o,$("#example2").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}else{o="<table id=example2 class='table table-bordered table-striped'><thead><tr><th>#</th><th>Guest Name</th><th>Room No</th><th>Guest Code</th><th>Action</th></tr></thead><tbody>";o+="</tbody></table>",document.getElementById("guest-data-table").innerHTML=o,$("#example2").DataTable({paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0})}}catch(e){}},error:function(){}})}var guestRecordForEdit="",recordForEdit=function(e){guestRecordForEdit=e,$("#guest-form-title").text("Update Guest"),$("#guestCode").val(e.guestCode),$("#editRoomNo").val(e.roomNumber),$("#editGuestName").val(e.name),$("#editGuestMob").val(e.mobile),$("#editCheckOut").val(e.checkoutDate),"true"==e.isMale?$("#editMale").prop("checked",!0):$("#editFemale").prop("checked",!0),$("#add-guest-form").css("display","none"),$("#update-guest-form").css("display","block")};function guestUpdate(){event.preventDefault();var e=guestRecordForEdit.roomNumber,t=guestRecordForEdit.name,a=guestRecordForEdit.mobile,o=guestRecordForEdit.checkoutDate,s=guestRecordForEdit.isMale,u=window.localStorage.getItem("hotelCodeVal"),d=window.localStorage.getItem("token"),n=document.getElementsByName("guestCode")[0].value.trim(),l=document.getElementsByName("editRoomNo")[0].value.trim(),r=document.getElementsByName("editGuestMob")[0].value.trim(),c=document.getElementsByName("editGuestName")[0].value.trim(),i=document.getElementsByName("editCheckOut")[0].value.trim(),m=document.getElementById("editMale").checked;if(e!=l||t!=c||a!=r||o!=i||s+""!=m+""){var g="api/guest/updateGuest?access_token="+d;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:g,data:'{"guestCode":'+n+',"roomNumber":"'+l+'","hotelId":"'+u+'","mobile":"'+r+'","name":"'+c+'","checkoutDate":"'+i+'","isMale":"'+m+'"}',success:function(e){try{1==e.success&&(toastr.success("Guest successfully updated"),$("#editRoomNo").val(""),$("#editGuestMob").val(""),$("#editGuestName").val(""),$("#editCheckOut").val(""),$("#guest-form-title").text("Add Guest"),$("#add-guest-form").css("display","block"),$("#update-guest-form").css("display","none"),updateGuestList())}catch(e){toastr.error("Guest updation failed")}},error:function(){toastr.error("Guest updation failed")}})}else toastr.error("Invalid operation modify atleast one data")}
fromDashboard=!1,open_Order_s=0,total_Order_s=0,total_feedback_count_s=0,checkedin_customer_s=0;var timeout,staffId=window.localStorage.getItem("clientId"),staffName=window.localStorage.getItem("userName");function bulkCheckoutGuest(e){event.preventDefault();window.localStorage.getItem("hotelCodeVal");var t="api/guest/checkoutBulk?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t,data:'{"checkoutGuests":"'+e+'"}',success:function(e){console.log(e)},error:function(){console.log("hello")}})}function getCheckedInCust(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),o="/api/guest/getActiveGuest?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,data:'{"hotelId":"'+t+'"}',success:function(e){try{for(var t,o=e,a=o.guests,s=[],n=[],r=0;r<a.length;r++){var d=a[r].checkoutDate;d=d.substr(d.indexOf("-")+1).trim(),d=moment(d),moment().diff(d)>0?s.push(a[r].guestCode):n.push(a[r])}var c,i=0,l="<ul id='checkedInCust' class='users-list clearfix'><li><img src='admin/assets/dist/img/22.png' id='myModal' style='cursor:pointer'><a data-pin-nopin='true'><a class='users-list-name' id='myModal_name' href='#'>Add Guest</a><span class='users-list-date'></span></li>";if(1==o.success){var u=n.length;i=u>=7?u-7:0,document.getElementById("checked-cust").innerHTML="<h3>"+u+"<h3>";for(var m=u-1;m>=i;m--){var g=n[m].status;void 0!==g&&null!=g||(g="ONLINE");var f=n[m].guestCode;c=n[m].name+"&nbsp;&nbsp;#"+n[m].roomNumber,t="true"==n[m].isMale?"admin/assets/dist/img/user1-128x128.jpg":"admin/assets/dist/img/user3-128x128.jpg",l="ONLINE"==g?l+'<li id="guestCode'+f+'"><img src='+t+" alt='User Image' class='context-menu-one' id='"+n[m].guestCode+"' name='"+c+"'><a class='users-list-name' href='#'>"+n[m].name+"</a><span class='users-list-date'><b>RM #:"+n[m].roomNumber+"</b></span></n><span id='guestStatus"+f+"' class='users-list-date'><i class='fa fa-circle text-success'></i><b> "+g+"</b></a></span><a class='users-list-name' href='#' onclick='view_order_summary("+n[m].guestCode+")'>order summary</a>":l+'<li id="guestCode'+f+'"><img src='+t+" alt='User Image' class='context-menu-one' id='"+n[m].guestCode+"' name='"+c+"'><a class='users-list-name' href='#'>"+n[m].name+"</a><span class='users-list-date'><b>RM #:"+n[m].roomNumber+"</b></span></n><span class='users-list-date'><i class='fa fa-circle text-danger'></i><b> "+g+"</b></a></span><a class='users-list-name' href='#' onclick='view_order_summary("+n[m].guestCode+")'>order summary</a>"}document.getElementById("list").innerHTML="</ul>"+l,$("#myModal").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))}),$("#myModal_name").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))})}else{l="<ul class='users-list clearfix'><li><img src='admin/assets/dist/img/22.png' id='myModal' style='cursor:pointer'><a data-pin-nopin='true' ><a class='users-list-name' href='#'>Add Guest</a><span class='users-list-date'></span></li>";document.getElementById("list").innerHTML="</ul>"+l,$("#myModal").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))}),$("#myModal_name").click(function(){$("#main-content").load("admin/addGuest.html?access_token="+window.localStorage.getItem("token"))})}}catch(e){}s.length>0&&bulkCheckoutGuest(s)},error:function(){}})}function getDashBoardDetails(){if(void 0!=window.localStorage.getItem("token")&&null!=window.localStorage.getItem("token")){var e=window.localStorage.getItem("hotelCodeVal"),t=window.localStorage.getItem("clientId"),o="/api/guest/getDashboardDetail?dept="+window.localStorage.getItem("departmentId")+"&access_token="+window.localStorage.getItem("token")+"&refreshToken=true&clientId="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,data:'{"hotelId":"'+e+'"}',success:function(e){try{var t=e,o=0;if(t.newtoken){window.localStorage.removeItem("token"),window.localStorage.setItem("token",t.newtoken);var a=window.localStorage.getItem("token");window.history.replaceState("","",window.location.pathname+"?access_token="+a)}if(1==t.success){var s=t.dashboard.pendingOrderCount,n=t.dashboard.orderCount,r=t.dashboard.checkedInCustomer,d=t.dashboard.feedbackCount,c=t.dashboard.guests,i=c.length;for($("ul#checkedInCust li").length,o=0;o<i;o++){var l="guestCode"+c[o].guestCode;if($("#"+l).length>0){var u=c[o].status;"ONLINE"==u?$("#guestStatus108").html("<i class='fa fa-circle text-success'></i><b> "+u+"</b>"):$("#guestStatus108").html("<i class='fa fa-circle text-danger'></i><b> "+u+"</b>")}}if(fromDashboard)open_Order_s=t.dashboard.pendingOrderCount,total_Order_s=t.dashboard.orderCount,total_feedback_count_s=t.dashboard.feedbackCount,checkedin_customer_s=t.dashboard.checkedInCustomer;else if(!fromDashboard&&(s>open_Order_s||n>total_Order_s||d>total_feedback_count_s||r>checkedin_customer_s)){loadOrdersForDashboard();var m=new Audio("admin/assets/audio/new-message.wav");if(s>open_Order_s){var g=s-open_Order_s;m.play(),getAllOpenOrders(),notification=new Notification("New Order",{body:"You have "+g+" new order(s)",requireInteraction:!0}),notification.onclick=function(){window.focus(),notification.close(),$("#main-content").load("admin/orders.html?access_token="+window.localStorage.getItem("token"))},setTimeout(function(){notification.close()},2e6)}open_Order_s=t.dashboard.pendingOrderCount,total_Order_s=t.dashboard.orderCount,total_feedback_count_s=t.dashboard.feedbackCount,checkedin_customer_s=t.dashboard.checkedInCustomer,getCheckedInCust()}fromDashboard=!1,document.getElementById("open-order").innerHTML="<h3>"+t.dashboard.pendingOrderCount+"<h3>",document.getElementById("total-order").innerHTML="<h3>"+t.dashboard.orderCount+"<h3>",document.getElementById("total-feedback").innerHTML="<h3>"+t.dashboard.feedbackCount+"<h3>",document.getElementById("checked-cust").innerHTML="<h3>"+t.dashboard.checkedInCustomer+"<h3>",open_Order_s=t.dashboard.pendingOrderCount,total_Order_s=t.dashboard.orderCount,total_feedback_count_s=t.dashboard.feedbackCount,checkedin_customer_s=t.dashboard.checkedInCustomer}}catch(e){}},error:function(){}}),timeout&&clearTimeout(timeout),timeout=setTimeout(getDashBoardDetails,29e3)}}function checkAndNotifyopenOrderThroughSMS(){var e=window.localStorage.getItem("staff_mobile"),t=window.localStorage.getItem("token"),o=window.localStorage.getItem("hotelCodeVal"),a="/admin/api/hotel/getOrdersToNotify?access_token="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:a,async:!1,data:'{"hotelCode":  '+o+',"staffId":'+staffId+"}",success:function(o){try{if(1==o.success&&o.count>0)try{$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"/api/guest/sendSMSForPendingOrders?access_token="+t,async:!1,data:'{"mobile":'+e+"}",success:function(e){},error:function(e,t,o){}})}catch(e){}}catch(e){}},error:function(){}}),setTimeout(checkAndNotifyopenOrderThroughSMS,12e4)}function signOut(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("clientId");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"/api/clients/logout?access_token="+e,data:'{"clientId":'+t+"}",success:function(e){try{1==e.success&&(window.localStorage.clear(),window.location.href="/../admin/login.html")}catch(e){}},error:function(e,t){}})}function pushNote(){$.contextMenu({selector:".context-menu-one",callback:function(e,t){var o=$(this).attr("name"),a=$(this).attr("id");"send"===e?(document.getElementById("guestid").value=a,$(".modal-title").html("Send Notification To "+o),document.getElementById("notification-div").style.display="block"):"Checkout"===e&&checkoutGuest(a)},items:{send:{name:"Send Notification"},Checkout:{name:"Checkout",icon:function(){return"context-menu-icon"}}}}),$(".context-menu-one").on("click",function(e){console.log("clicked",this)}),$("#closebtn").click(function(){$("#msg_title").val(""),$("#messages").val(""),document.getElementById("notification-div").style.display="none"}),$("#closeNotify").click(function(){$("#msg_title").val(""),$("#messages").val(""),document.getElementById("notification-div").style.display="none"}),$("#pushMsg").on("click",function(e){$.trim($("#msg_title").val())?$.trim($("#messages").val())?sendPushMsgtoClient():$("#messages").focus():$("#msg_title").focus()}),$("#send_to_all").click(function(){document.getElementById("notification-div").style.display="block",$("#msg_title").val(""),$("#messages").val(""),$(".modal-title").html("Send Notification To All")})}function sendPushMsgtoClient(){var e,t=window.localStorage.getItem("token"),o=window.localStorage.getItem("hotelCodeVal"),a=$.trim($("#guestid").val()),s=$.trim($("#msg_title").val()),n=$.trim($("#messages").val());e=a?{hotelId:o,guestId:a,title:s,msg:n}:{hotelId:o,title:s,msg:n};var r=JSON.stringify(e),d="api/guest/pushNotification?access_token="+t;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:d,data:r,success:function(e){try{1==e.success?($("#msg_title").val(""),$("#messages").val(""),$("#guestid").val(""),toastr.success("Message sent successfully"),document.getElementById("notification-div").style.display="none"):console.log("inserted count is: "+e.insertedCount)}catch(e){$("#msg_title").val(""),$("#messages").val(""),$("#guestid").val(""),toastr.error("failed"),document.getElementById("notification-div").style.display="none"}},error:function(){$("#msg_title").val(""),$("#messages").val(""),$("#guestid").val(""),toastr.error("Message sent failed"),document.getElementById("notification-div").style.display="none"}})}function loadOrdersForDashboard(){var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("clientId"),o=window.localStorage.getItem("hotelCodeVal"),a="/admin/api/hotel/getAllOrder?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:a,data:'{"staffId":'+t+',"hotelCode":'+o+"}",success:function(e){try{if(1==e.success){for(var t="<table class=table no-margin'><thead><tr><th>Room #</th><th>Items</th><th>Status</th><th>Time</th><th>Action</th></tr></thead><tbody>",o=0,a=[],s=[],n=e.orders,r=0;r<e.orders.length;r++){var d=n[r].guest.guestCode,c=n[r].guest.roomNumber;for(k=0;k<n[r].order.length;k++){var i=JSON.parse(JSON.stringify(n[r].order[k]));i.roomNo=c,i.guestCode=d,a.push(i),s.push(n[r].guest.roomNumber)}}var l=JSON.parse(JSON.stringify(a));o=0;l.sort(function(e,t){return moment(t.orderDate,"MMM DD YYYY, h:mm:ss a")-moment(e.orderDate,"MMM DD YYYY, h:mm:ss a")});for(var u=0;u<a.length&&!(o>=7);u++){var m="";for(k=0;k<l[u].items.length;k++)m+=l[u].items[k].itemName+", ";(m=m.substring(0,m.length-2)).length>12&&(m=m.substring(0,12)+"...");var g=l[u].orderStatus,f="",h="",p=moment(new Date(l[u].orderDate+" UTC")).format("MMM DD, hh:mm:ss a").toString();"Completed"!=g&&(o++,f="<span class='label label-success'>Completed</span>","Inprogress"==g&&(f="<span class='label label-info'>In progress</span>",h="<a style='cursor:pointer' class='label label-info' onclick=\"performOrderClose('"+l[u].orderId+"','"+l[u].guestCode+"')\">Close</a>"),"Initialize"==g&&(f="<span class='label label-danger'>Open</span>",h="<a style='cursor:pointer' class='label label-info' onclick=\"performOrderAccept('"+l[u].orderId+"','"+l[u].guestCode+"')\">Accept</a>"),t=t+"<tr><td>"+l[u].roomNo+"</td><td>"+m+"</td><td>"+f+"</td><td>"+p+"</td><td>"+h+"</td></tr>")}t+="</tbody></table>",document.getElementById("dashboard-order-box").innerHTML=t}else document.getElementById("dashboard-order-box").innerHTML="<span><center>Unable to load Orders</center></span>"}catch(e){}},error:function(){}})}function performOrderClose(e,t){var o="/api/guest/completeOrder?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,data:'{"userCode": '+t+',"orderId": '+e+',"staffId": '+staffId+',"staffName": "'+staffName+'","remark": "Good Service"}',success:function(e){try{1==e.success&&(toastr.success("Order completed"),loadOrdersForDashboard(),getDashBoardDetails())}catch(e){toastr.success("Failed to complete order")}},error:function(){}})}function performOrderAccept(e,t){var o="/api/guest/assignStaff?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:o,async:!1,data:'{"userCode": '+t+',"orderId": '+e+',"staffId": '+staffId+',"staffName": "'+staffName+'"}',success:function(e){try{1==e.success?(toastr.success("Order accepted"),loadOrdersForDashboard(),getDashBoardDetails()):toastr.error("failed to accept order")}catch(e){}},error:function(e,t){}})}function checkoutGuest(e){var t="/api/guest/chekoutGuest?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t,async:!1,data:'{"userCode": '+e+"}",success:function(e){try{1==e.success?(toastr.success("Guest checked-out successfully"),getCheckedInCust()):toastr.error("Guest checked-out failed")}catch(e){}},error:function(e,t){}})}function view_order_summary(e){isValidToken(),$("#main-content").load("admin/order-sumary.html?access_token="+window.localStorage.getItem("token")),setTimeout(function(){var t="/api/guest/getOrderListByGuestId?access_token="+window.localStorage.getItem("token");$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:t,data:'{"guestId":'+e+"}",success:function(e){try{var t="";if(e&&e.guest&&(t+="<tr>",t+="<td>"+e.guest.guestCode+"</td>",t+="<td>"+e.guest.guestName+"</td>",t+="<td>"+e.guest.roomNumber+"</td>",t+="<td>"+e.guest.mobile+"</td>",t+="<td>"+e.guest.checkinDate+"</td>",t+="</tr>"),document.getElementById("guestDetailId").innerHTML=t,e&&e.order){for(var o="",a=1,s=0,n=0;n<e.order.length;n++)if(e.order[n].items&&Array.isArray(e.order[n].items)){for(var r=0;r<e.order[n].items.length;r++){var d=0,c=e.order[n].items[r].qty*e.order[n].items[r].amount*e.order[n].items[r].sgst/100;isNaN(c)&&(c=0);var i=e.order[n].items[r].qty*e.order[n].items[r].amount*e.order[n].items[r].cgst/100;isNaN(i)&&(i=0),s+=d=e.order[n].items[r].qty*e.order[n].items[r].amount+(i+c),o+="<tr>",o+="<td>"+a+++"</td>",o+="<td>"+e.order[n].items[r].itemName+"</td>",o+="<td>"+e.order[n].orderStatus+"</td>",o+="<td>"+e.order[n].orderDate+"</td>",o+="<td>"+e.order[n].items[r].qty+"</td>",o+="<td>"+e.order[n].items[r].amount+"</td>",o+="<td>"+(e.order[n].items[r].qty*e.order[n].items[r].amount).toFixed(2)+"</td>",o+="<td>"+c.toFixed(2)+"</td>",o+="<td>"+i.toFixed(2)+"</td>",o+="<td>"+d.toFixed(2)+"</td>",o+="</tr>"}o+="<tr>",o+="<th colspan=9> Grand Total Amount (In Rupees)</th>",o+="<th>"+s.toFixed(2)+"</th>",o+="</tr>"}document.getElementById("myOrderId").innerHTML=o}}catch(e){}},error:function(){}},2e3)})}
function addWifi(){event.preventDefault();var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),a=$.trim($("#wifi-name").val()),s=$.trim($("#enable-wifi").val()),o=$.trim($("#sms-Temp").val()),n=$.trim($("#static-password").val()),i="/admin/api/hotel/addWifi?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:i,data:'{"hotelId": '+t+' ,"name":"'+a+'","type":"static","msgTemplate":"'+o+'","isEnabled":"'+s+'","staticPassword":"'+n+'"}',success:function(e){console.log("browser json"+e);try{1==e.success?toastr.success("Wifi successfully added"):console.log("add wifi failed")}catch(e){}},error:function(e,t){toastr.error("add wifi failed")}})}function getWifi(){event.preventDefault();var e=window.localStorage.getItem("token"),t=window.localStorage.getItem("hotelCodeVal"),a="/admin/api/hotel/getWifi?access_token="+e;$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:a,data:'{"hotelId": '+t+"}",success:function(e){try{1==e.success?e.hasOwnProperty("res")&&1==e.res.length&&(e.res[0].hasOwnProperty("name")&&(document.getElementById("wifi-name").value=e.res[0].name),e.res[0].hasOwnProperty("staticPassword")&&(document.getElementById("static-password").value=e.res[0].staticPassword),e.res[0].hasOwnProperty("msgTemplate")&&(document.getElementById("sms-Temp").value=e.res[0].msgTemplate),e.res[0].hasOwnProperty("isEnabled")&&"true"==e.res[0].isEnabled&&$("#enable-wifi").prop("checked",!0)):console.log("fetch wifi failed")}catch(e){}},error:function(e,t){toastr.error("fetch wifi failed")}})}